<h1>hello world@</h1>
<div>{{code  + "" + process + "somthing"}}</div>
<h3>bye bye</h3>
<script type="text/javascript">
  const html = `<html>
                  <head>
                    <title>{{pleasureTown}}</title>
                  </head>
                  <body>
                    <h1>{{greeting}}</h1>
                    <h4 {{(typeof hide) === "boolean" && hide === true ? 'hidden' : ''}}>
                      {{new Date(\'thisDate\') + 29}}
                    </h4>
                    </body>
                  </html>`;
  const parseArray = [{
    name: 'code',
    regex: /\{\{.*?\}\}/g,
    actionM: 1
  },{
    name: 'string',
    regex: /('|"|`).*?[^\\]((\\\\)*|[^\\])(\1)/g,
    actionS: 2
  },{
    name: 'keywords',
    regex: /new|typeof|true|false|undefined|null|NaN/g,
    actionS: 3
  }, {
    name: 'operators',
    regex: /[^a-z^A-Z^0-9]{1,}/g,
    actionS: 4
  }, {
    name: 'objects',
    regex: /([a-zA-Z][a-zA-Z0-9]{1,})/g,
    actionM: 'get("$1")'
  }];

  class RegArr {
    constructor(string, array) {
      const newLine = 'akdiehtpwksldjfurioeidu';
      const noNewLines = string.replace(/\n/g, newLine);
      const stack = [{str: noNewLines, index: 0}];
      const details = {};
      let finalStr = '';
      const obj = {};
      array = array.concat({name: 'untouched', regex: /(.*)/g, actionM: '$1'});

      obj.original = function () {return string;};
      obj.result = function () {return finalStr};
      obj.details = function () {return details};

      function split(str, array) {
        const splitted = [];
        for (let index = 0; array && index < array.length; index += 1) {
          const elem = array[index];
          const startIndex = str.indexOf(elem);
          if (startIndex !== -1) {
            const length = elem.length;
            if (startIndex !== 0 ) {
              splitted.push(str.substring(0, startIndex));
            }
            str = str.substring(startIndex + length);
          }
        }
        if (str.length > 0) {
            splitted.push(str);
        }
        return splitted;
      }

      function next(str, action, regex) {
        if (str === null) return;
        if (action) {
          if (Number.isInteger(action)) {
            stack.push({str, index: action})
          } else {
            finalStr += str.replace(regex, action);
          }
        } else {
          stack.push({str, index: array.length - 1});
        }
      }

      function idk(arr1, arr1Action, arr2, arr2Action, regex) {
        for (let index = arr1.length - 1; index > -1; index -= 1) {
          if (arr2 && arr2[index]) {
            next(arr2[index], arr2Action, regex);
          }
          next(arr1[index], arr1Action, regex);
        }
      }

      function addDetails(name, attr, array) {
        if (!array) return;
        array = array.map(function (value) {return value.replace(new RegExp(newLine, 'g'), '\n')});
        if (!details[name]) details[name] = {};
        if (!details[name][attr]) details[name][attr] = [];
        details[name][attr] = details[name][attr].concat(array);
      }

      function construct(str, index) {
        if (str === undefined) return;
        const elem = array[index];
        const matches = str.match(elem.regex);
        const splitted = split(str, matches);
        addDetails(elem.name, 'matches', matches);
        addDetails(elem.name, 'splitted', splitted);
        let finalStr = '';
        if (matches && matches[0] && str.indexOf(matches[0]) === 0) {
          idk(matches, elem.actionM, splitted, elem.actionS, elem.regex);
        } else {
          idk(splitted, elem.actionS, matches, elem.actionM, elem.regex);
        }
      }

      function process() {
        while (stack.length > 0) {
          const curr = stack.pop();
          construct(curr.str, curr.index);
        }
        finalStr = finalStr.replace(new RegExp(newLine, 'g'), '\n');
      }
      process();
      return obj;
    }
}

</script>
